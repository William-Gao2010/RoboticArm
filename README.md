# RoboticArm
# STC8H 激光云台控制程序说明

## 文件结构
- `main.c` – 主流程：串口接收、协议解析、PWM 输出、激光开关  
- `PWM.C` – PWM 初始化与占空比更新

## 快速索引
| 名称 | 作用 |
|---|---|
| `check()` | 在串口缓冲区里找帧头 `0x91 0x78`，提取 5 字节到 `number[]` |
| `DimensionsCheck()` | 根据 `number[2]/[3]` 计算 `DegreeData[0/1/2]`（云台角度） |
| `run()` | 把 `DegreeData[]` 写入 5 路 PWM，并插入延时 |
| `UpdatePwm(num, duty‰)` | 将千分比占空比写入对应通道的 CCR 寄存器 |
| `laser` | `P3^3`，高电平开激光 |

## 串口协议
- 帧头：`0x91 0x78`  
- 数据：`number[0..4]`（5 字节）  
- `number[2]` → Y 轴偏移，`number[3]` → X 轴偏移  
- 无校验和，回发原帧（调试）

## PWM 参数
- 时钟：35 MHz → 计数频率 ≈ 3.18 MHz  
- ARR：58333 → PWM 频率 ≈ 54.5 Hz  
- 占空比范围：0–1000 ‰，对应 0–58333 计数

## 引脚映射
| PWM 通道 | 寄存器 | 引脚 | 用途 |
|---|---|---|---|
| 1 | CCR1 | P1.0 | 舵机/电机 1 |
| 2 | CCR2 | P1.1 | 舵机/电机 2 |
| 3 | CCR3 | P1.2 | 舵机/电机 3 |
| 4 | CCR4 | P1.3 | 舵机/电机 4 |
| 5 | CCR5 | P2.0 | 舵机/电机 5 |

## 已知改进点
1. `check()` 越界风险：需限制 `num1+4 < BUFFER_LEN`  
2. 魔法数字（`0x0A`、`0x08`、`0x7F`）改为宏  
3. 延时阻塞：用定时器中断替代 `Delay1ms`  
4. 激光可改为 PWM 调光

## 使用步骤
1. Keil-C51 选择 STC8H 系列，加载工程  
2. 串口 115200 8N1，发送 5 字节帧  
3. 观察云台动作 + 激光同步

##开发人员
@JChanty 2013206955@qq.com
@WilliamGao 17156310913ghj@gmail.com
